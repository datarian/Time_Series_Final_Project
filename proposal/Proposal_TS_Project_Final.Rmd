---
title: "Proposal"
author: "Time series_spruce_sub900 Analysis"
date: "8 MÃ¤rz 2018"
bibliography: ../final_project.bib
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data

Dendrochronology data has been supplied by the archaeological service of the canton Berne [@dendroBern] through a personal contact at the dendrology laboratory in Sutz, BE.

The chronologies have been compiled from individual measurements in the canton of Berne. Typically, the wooden structure of old buildings is sampled by boring the beams. The drilling core is then analyzed by microscoping, recording the sequence of tree ring widht. Subsequently, the sample is matched with existing chronological data, serving the double purpose of strengthening the chronology by overlaying a certain period with more evidence as well as dating the sample in an effort to date the construction year of the sampled building.

All chronologies end in 2017 and have varying lengths of at least 650 years.
The supplier of the data recommended ignoring data after 1800 due to an insufficient amount of data (individual treering measurements to compute a robust annual mean) for the period after 1800.

## Spruce data above 900 m
This chronology was compiled from buildings in the Bernese Oberland which are located above 900 m. Spruce was a common building material and there is a wealth of houses supplying data. It is almost sure that trees have not been transported uphill when building houses, so this data can be assumed to originate almost entirely from trees that grew above 900 m. It is known that treering width at high altitudes is mostly dependent on the average temperature during spring.

## Preliminary Analysis

Stationarity has been demonstrated.

### Transformations

A polynomial of order 2 has been fitted to the raw data. Then, the residuals have been divided by the fitted values (see [@woollons1990time]).

```{r preparedata}
library(itsmr)
library(tseries)
library(MASS)
library(forecast)

spruce_sup900 <- read.table("../data/62167_picea_abv900.txt",
                            skip=4,nrows=68)
spruce_sup900_lastrow <- read.table("../data/62167_picea_abv900.txt",
                                    skip=72,nrows=1)
ssup9 <- spruce_sup900[,-c(1,2,3)]
ssup9l <- spruce_sup900_lastrow[,-c(1,2,3)]

series_spruce_sup900 <- c()
for (i in 1:nrow(ssup9)) {
    for (j in 1:ncol(ssup9)) {
        series_spruce_sup900 <- c(series_spruce_sup900,as.integer(ssup9[i,j]))
    }
}
series_spruce_sup900 <- c(series_spruce_sup900,as.integer(ssup9l))
spruce_sup_900_ts <- ts(series_spruce_sup900, start=1332)


plot(spruce_sup_900_ts,
     main="Spruce, > 900 m",
     ylab="tree ring width [1/100 mm]",
     xlab="year")


# getting windows of the two series from 1332 to 1800:
spruce_window <- window(spruce_sup_900_ts,end=c(1800))
climate_window <- window(climate_ts,start=start(spruce_window),end=end(spruce_window))
plotc(spruce_window)

log_spruce_window <- log(spruce_window)
t <- seq(1,length(spruce_window))
t2 <- t^2

d <- data.frame(cbind(log_spruce_window,t,t2))

#log_t <- log(t)
#m1 <- lm(log_spruce_window ~ log_t)
#summary(m1)

m2 <- lm(log_spruce_window ~ t+t2,data=d)
summary(m2)

# Transformation of residuals
i <- (m2$residuals/m2$fitted.values)

plotc(i)
acf(i)
pacf(i)

kpss.test(i)
adf.test(i)
pp.test(i)

model_ar2 <- arima(i,order=c(2,0,0))
summary(model_ar2)

model_arma11 <- arima(i,order=c(1,0,1))
summary(model_arma11)
```

# Questions to be answered

    * Hypothetical missing values will be imputed using model predictions.
    * If time permits, the impact of exogenous (climatic) data [@NOAA] will be studied for a small subset (1895 - 1990) of another timeseries [@dplR].

# Methods

The project team will answer the questions using the following methods:

    * Finding the best model through R's methods autofit, best.ARMA2 and so on
    * Prediction of missing values with the obtained model vs. using a dedicated R package [@moritz2015imputets]


# References
