# Modelling / Analysis

## Achieving stationarity

It was decided to use the series obtained through the intuitive approach described in section [2.1.3](#logtrans). The series is mean-centered and shows a relatively constant variance. A weak stationarity can therefore be assumed (see figure  \ref{fig:stationarity}).

The ACF and PACF for this stationary series (see figure \ref{fig:acfpacf_chosen}), gave further evidence for a usable result.

However, two outliers remain. These were already evident in the original data. A coincidence of extreme values paired with a small standard deviation of the samples in these years could not be removed by the chosen transformation. A possible explanation could be volcanic activity which has been shown to impact tree growth [@sigl2015timing], but would only explain the negative outlier.

The results of the other two approaches were not satisfactory. These results are not shown in the report for the sake of brevity.

```{r stationarity, fig.cap="The stationary series obtained throgh scaling, log-transformation and order-1 trend removal is displayed on the left. On the right, the qq-plot of the series is shown. The series seems to be normally distributed, except for the two outliers at around 1520 and 1550."}
grid.draw(egg::ggarrange(stationaritylog_order1_plot,
    stationarity_qq_plot + theme(aspect.ratio = 1),
    ncol=2,
    widths = c(0.7,0.3)))
```

## Model selection

The shape of the ACF and PACF (figure \ref{fig:acfpacf_chosen}) give some basis to argue for either an AR(1) or ARMA(1,1) process (also refer to the decision matrix in table \ref{tab:acfpacfdecision}).

```{r acfpacf_chosen, fig.cap="ACF (left) and PACF (right) of the chosen stationary time series."}
acf <- ggAcf(data_log_order1_varstab$y, main="") +
    theme(aspect.ratio = 0.618) # looks exponential
pacf <- ggPacf(data_log_order1_varstab$y,main="") +
    theme(aspect.ratio = 0.618) 
grid.arrange(acf,pacf,ncol=2)

```

Confirming the graphical analyis, an ARMA(1,1) model was found through `autofit` from package `itsmr` with parameters `autofit(x=Xt,p=0:3, q=0:3,mean.include=F)`. Using the function `arima`, similar values for $\phi$ and $\theta$ were found. Additionally, it was decided to also include an AR(1) and AR(2) model into the further analysis. However, the best model in terms of AIC is ARMA(1,1) as can be seen in table \ref{tab:modelaic}.

```{r modelaic}
kable(model_aic_compared, booktabs=T,caption="Comparison of AIC of the fitted models.") %>%
    kable_styling(latex_options="hold_position",position="center")
```

The parameters for all models are significant, as can be seen by comparing their values to the respective standard deviations (see table \ref{tab:modelcomp}).

```{r modelcomp}
kable(modelComparisonTable, booktabs=T,
      caption="Model parameters for ARMA(1,1) and AR(1).",
      escape=FALSE,
      row.names = FALSE) %>%
    kable_styling(latex_options = c("hold_position"), position = "center") %>%
    column_spec(1,bold=T)%>%
    collapse_rows(columns=c(1),headers_to_remove=c(1), latex_hline = "custom", custom_latex_hline = 1)
```

The validity of all models was assessed graphically by plotting the standardized residuals, residual ACF and Ljung-Box test for independence for all three models combined (see figure \ref{fig:tsdiag}).

For the ARMA(1,1) model, the residuals are confirmed to be white noise (see again figure \ref{fig:tsdiag}). The Ljung-box statistic for various lags showed that for the AR(1) and AR(2) model, the residuals are not white noise (see \ref{fig:tsdiag.ar1}, which is also evident from the ACF, which shows that some dependency is left (too many values are outside of the 95%-bounds).

```{r tsdiag, fig.cap="Diagnostic plots for ARMA(1,1), AR(1) and AR(2). Top: Standardized residuals, middle: ACF, bottom: Ljung-Box test",fig.width=18,fig.asp=0.618,out.width="0.7\\linewidth"}

legend_plot <- ggpubr::get_legend(boxtest_plot)

grid.draw(egg::ggarrange(residuals_plot + theme(legend.position = "none"),
    acf_comparison_plot + theme(legend.position = "none", aspect.ratio = 0.4),
    boxtest_plot + theme(legend.position = "none", aspect.ratio = 0.4),
    ncol=1,
    heights = c(1,0.8,0.8),
    top=legend_plot))

```

## Imputation

The results of the imputation can be seen in \ref{fig:imputationcomparison}.

```{r imputationcomparison, fig.cap="Comparison of imputed values obtained through different methods."}
pplot_comparison
```
